name: Safety Check
description: Run safety checks for MLKEM implementation using Valgrind

runs:
  using: composite
  steps:
  - uses: cachix/install-nix-action@v31
    with:
      nix_path: nixpkgs=channel:nixos-unstable
  - name: Checks Dependencies
    shell: bash 
    run: nix-shell --arg full false --run "echo Dependencies OKâ€¦"
  - name: Run Valgrind Memory Check
    shell: bash 
    run: nix-shell --arg full false --run "make -C bench memory-check"
  - name: Generate Memory Check Summary
    if: always()
    shell: bash
    run: nix-shell --arg full false --run "./scripts/check_memory.sh"